<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yerel Depolamalı Fotoğraf Galerisi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Tailwind'e ek olarak özel stiller */
        .image-card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .image-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .drag-area {
            min-height: 150px;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 sm:p-8 font-sans">

    <!-- Sinyal (Alert) Konteyneri -->
    <div id="alert-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <header class="text-center mb-10">
        <h1 class="text-4xl font-extrabold text-teal-700 mb-2">Yerel Fotoğraf Galerisi (LocalStorage)</h1>
        <p class="text-gray-600 text-lg">
            Görseller tarayıcınızın LocalStorage'ında saklanacaktır.
        </p>
        <p class="text-sm text-red-500 font-semibold mt-2">
            UYARI: LocalStorage kapasitesi sınırlıdır (5-10MB). Büyük dosyalar performansı düşürür ve depolama limitini hızla doldurur.
        </p>
    </header>

    <!-- Yükleme Alanı -->
    <section class="max-w-4xl mx-auto mb-12 p-6 bg-white rounded-xl shadow-2xl border border-gray-100">
        <h2 class="text-2xl font-semibold text-gray-800 mb-6 border-b pb-3">1. Yeni Fotoğraf Ekle</h2>
        
        <div id="drop-area" 
             class="drag-area flex flex-col items-center justify-center p-10 border-4 border-dashed rounded-xl transition duration-200 border-gray-300 hover:border-teal-400 hover:bg-teal-50"
             onclick="document.getElementById('file-input').click()">

            <svg class="w-12 h-12 text-teal-400 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
            <p class="text-teal-600 font-medium transition duration-150">
                Dosya Seçmek için Tıklayın veya Buraya Sürükleyip Bırakın
            </p>
            <p id="file-name" class="mt-2 text-sm text-gray-500"></p>
        </div>

        <input 
            id="file-input" 
            type="file" 
            accept="image/*" 
            class="hidden" 
            onchange="handleFileSelect(this.files)"
        />

        <div class="mt-6 flex justify-center">
             <button
                id="upload-button"
                onclick="uploadPhoto()"
                disabled
                class="px-8 py-3 text-white font-bold rounded-lg transition duration-300 shadow-md bg-teal-300 cursor-not-allowed hover:bg-teal-400 disabled:opacity-50"
            >
                Galerime Ekle
            </button>
        </div>
    </section>

    <!-- Galeri Alanı -->
    <section class="max-w-6xl mx-auto p-6 bg-white rounded-xl shadow-2xl">
        <h2 class="text-2xl font-semibold text-gray-800 mb-6 border-b pb-3">2. Galeriniz (<span id="photo-count">0</span> Fotoğraf)</h2>
        <div id="gallery-container" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
            <!-- Görseller buraya yüklenecek -->
        </div>
    </section>

    <footer class="mt-10 text-center text-gray-400 text-sm">
        <p>&copy; Yerel Depolama Kullanılarak Hazırlanmıştır.</p>
    </footer>

    <script>
        // Global State
        let selectedFile = null;
        const STORAGE_KEY = 'local_photo_gallery_items';

        // --- Yardımcı Fonksiyonlar ---

        /**
         * Basit bir bildirim mesajı (alert) gösterir.
         * @param {string} message Görüntülenecek mesaj.
         * @param {string} type 'success', 'error' veya 'info'.
         */
        function showAlert(message, type = 'info') {
            const container = document.getElementById('alert-container');
            const id = Date.now();
            let colorClasses = '';

            switch (type) {
                case 'error':
                    colorClasses = 'bg-red-500 text-white';
                    break;
                case 'success':
                    colorClasses = 'bg-green-500 text-white';
                    break;
                case 'info':
                default:
                    colorClasses = 'bg-blue-500 text-white';
                    break;
            }

            const alertDiv = document.createElement('div');
            alertDiv.id = `alert-${id}`;
            alertDiv.className = `p-4 rounded-lg shadow-xl flex items-center transition-all duration-300 transform translate-x-full opacity-0 ${colorClasses}`;
            alertDiv.innerHTML = `
                <p class="font-semibold mr-4">${message}</p>
                <button onclick="closeAlert('${id}')" class="p-1 rounded-full hover:bg-opacity-80 transition">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            `;
            container.appendChild(alertDiv);

            // Animasyonla içeri kaydır
            setTimeout(() => {
                alertDiv.classList.remove('translate-x-full', 'opacity-0');
            }, 10);

            // Hata değilse 5 saniye sonra otomatik kapat
            if (type !== 'info') {
                setTimeout(() => closeAlert(id), 5000);
            }
        }

        /**
         * Belirtilen ID'ye sahip bildirimi kapatır.
         * @param {number} id Kapatılacak bildirimin ID'si.
         */
        function closeAlert(id) {
            const alertDiv = document.getElementById(`alert-${id}`);
            if (alertDiv) {
                // Kapanma animasyonu
                alertDiv.classList.add('translate-x-full', 'opacity-0');
                setTimeout(() => {
                    alertDiv.remove();
                }, 300);
            }
        }

        /**
         * Dosya girişinden dosya seçimi yapıldığında tetiklenir.
         * @param {FileList} files Kullanıcının seçtiği dosyalar listesi.
         */
        function handleFileSelect(files) {
            const file = files[0];
            const uploadButton = document.getElementById('upload-button');
            const fileNameDisplay = document.getElementById('file-name');

            if (file && file.type.startsWith('image/')) {
                selectedFile = file;
                uploadButton.disabled = false;
                uploadButton.classList.remove('bg-teal-300', 'cursor-not-allowed', 'disabled:opacity-50');
                uploadButton.classList.add('bg-teal-600', 'hover:bg-teal-700');
                fileNameDisplay.textContent = `Seçilen Dosya: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
                showAlert(`Görsel "${file.name}" yüklenebilir.`, 'info');
            } else {
                selectedFile = null;
                uploadButton.disabled = true;
                uploadButton.classList.add('bg-teal-300', 'cursor-not-allowed', 'disabled:opacity-50');
                uploadButton.classList.remove('bg-teal-600', 'hover:bg-teal-700');
                fileNameDisplay.textContent = 'Lütfen bir görsel dosyası (.jpg, .png vb.) seçin.';
                if (file) {
                    showAlert('Lütfen sadece görsel dosyası seçin.', 'error');
                }
            }
            // Dosya inputunu sıfırla ki aynı dosyayı tekrar seçebilsin
            document.getElementById('file-input').value = ''; 
        }

        /**
         * LocalStorage'dan fotoğraf listesini yükler.
         * @returns {Array} Fotoğraf meta verileri listesi.
         */
        function loadPhotos() {
            try {
                const json = localStorage.getItem(STORAGE_KEY);
                return json ? JSON.parse(json) : [];
            } catch (e) {
                console.error("LocalStorage yüklenirken hata:", e);
                showAlert('Yerel depolama verileri yüklenemedi. Bozuk olabilir.', 'error');
                return [];
            }
        }

        /**
         * LocalStorage'a fotoğraf listesini kaydeder.
         * @param {Array} photos Kaydedilecek fotoğraf listesi.
         */
        function savePhotos(photos) {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(photos));
            } catch (e) {
                console.error("LocalStorage'a kaydederken hata:", e);
                showAlert(`Yerel depolama alanı dolu. Görsel kaydedilemedi. (Hata: ${e.message})`, 'error');
            }
        }

        /**
         * Galeriyi DOM'da günceller.
         */
        function renderGallery() {
            const photos = loadPhotos();
            const container = document.getElementById('gallery-container');
            const countSpan = document.getElementById('photo-count');

            container.innerHTML = '';
            countSpan.textContent = photos.length;

            if (photos.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center p-10 text-gray-500 border border-dashed rounded-lg">
                        <svg class="w-10 h-10 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.218A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.218A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                        <p class="font-medium">Henüz fotoğraf yok. Lütfen bir görsel yükleyin.</p>
                    </div>
                `;
                return;
            }

            photos.forEach(photo => {
                const card = document.createElement('div');
                card.id = `photo-${photo.id}`;
                card.className = "image-card relative group bg-gray-100 rounded-lg overflow-hidden";
                card.innerHTML = `
                    <img 
                        src="${photo.base64Data}" 
                        alt="${photo.fileName}" 
                        class="w-full h-40 object-cover" 
                        title="${photo.fileName}"
                        onerror="this.onerror=null;this.src='https://placehold.co/400x400/999999/FFFFFF?text=Base64+Hata'"
                    />
                    
                    <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300 space-x-2">
                        <!-- Sil Butonu -->
                        <button 
                            onclick="deletePhoto('${photo.id}')" 
                            class="p-2 rounded-full bg-red-600 text-white hover:bg-red-700 transition"
                            title="Sil"
                        >
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                        </button>
                    </div>
                    
                    <div class="p-2 text-center text-sm truncate font-medium text-gray-700" title="${photo.fileName}">
                        ${photo.fileName}
                    </div>
                `;
                container.appendChild(card);
            });
        }

        /**
         * Seçilen görseli okur, Base64'e çevirir ve LocalStorage'a kaydeder.
         */
        function uploadPhoto() {
            if (!selectedFile) {
                showAlert('Lütfen önce bir görsel dosyası seçin.', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const base64Data = e.target.result;
                const photos = loadPhotos();
                
                // Yeni fotoğraf objesi
                const newPhoto = {
                    id: Date.now().toString(), // Benzersiz ID
                    fileName: selectedFile.name,
                    base64Data: base64Data, // LocalStorage'a kaydedilen Base64 veri
                    size: selectedFile.size,
                    uploadedAt: new Date().toISOString()
                };

                photos.unshift(newPhoto); // En yeni görseli başa ekle

                savePhotos(photos);
                renderGallery();

                // Yükleme alanını temizle
                selectedFile = null;
                document.getElementById('upload-button').disabled = true;
                document.getElementById('upload-button').classList.remove('bg-teal-600', 'hover:bg-teal-700');
                document.getElementById('upload-button').classList.add('bg-teal-300', 'cursor-not-allowed', 'disabled:opacity-50');
                document.getElementById('file-name').textContent = '';
                showAlert(`"${newPhoto.fileName}" galeriye eklendi.`, 'success');
            };

            reader.onerror = function() {
                showAlert('Dosya okuma başarısız oldu.', 'error');
            };

            reader.readAsDataURL(selectedFile); // Dosyayı Base64'e çevirerek oku
        }

        /**
         * Belirtilen ID'ye sahip fotoğrafı LocalStorage'dan siler.
         * @param {string} id Silinecek fotoğrafın ID'si.
         */
        function deletePhoto(id) {
            let photos = loadPhotos();
            const initialLength = photos.length;
            
            // Seçilen ID dışındaki tüm fotoğrafları filtrele
            photos = photos.filter(photo => photo.id !== id);

            if (photos.length < initialLength) {
                savePhotos(photos);
                renderGallery();
                showAlert('Fotoğraf başarıyla silindi.', 'success');
            } else {
                showAlert('Silinecek fotoğraf bulunamadı.', 'error');
            }
        }
        
        // --- Sürükle Bırak İşleyicileri ---
        window.onload = function() {
            const dropArea = document.getElementById('drop-area');

            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, () => {
                    dropArea.classList.add('border-teal-500', 'bg-teal-50');
                }, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, () => {
                    dropArea.classList.remove('border-teal-500', 'bg-teal-50');
                }, false);
            });

            dropArea.addEventListener('drop', handleDrop, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFileSelect(files);
            }

            // Başlangıçta galeriyi yükle
            renderGallery();
        };

    </script>
</body>
</html>
